<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>OnePos: Quick Start quide for common NVM driver</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">OnePos
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.1.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Quick Start quide for common NVM driver </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This is the quick start quide for the <a class="el" href="group__nvm__group.html">Common NVM driver</a>, with step-by-step instructions on how to configure and use the driver in a selection of use cases.</p>
<p>The use cases contain several code fragments. The code fragments in the steps for setup can be copied into a custom initialization function, while the steps for usage can be copied into, e.g., the main application function.</p>
<h1><a class="anchor" id="nvm_basic_use_case"></a>
Basic use case</h1>
<p>In this basic use case, NVM driver is configured for Internal Flash</p>
<h1><a class="anchor" id="nvm_basic_use_case_setup"></a>
Setup steps</h1>
<h2><a class="anchor" id="nvm_basic_use_case_setup_code"></a>
Example code</h2>
<p>Add to you application C-file: </p>
<div class="fragment"><div class="line">        <span class="keywordflow">if</span>(<a class="code" href="xmega__nvm_8c.html#a0ac16f4de49f2f0df16e3cf56be5f578" title="Initialize the non volatile memory specified.">nvm_init</a>(INT_FLASH) == <a class="code" href="group__group__xmega__utils__status__codes.html#gga751c892e5a46b8e7d282085a5a5bf151a7e4a42e3b6dd63708c64cf3db6f69566" title="Success.">STATUS_OK</a>)</div>
<div class="line">          do_something();</div>
</div><!-- fragment --><h2><a class="anchor" id="nvm_basic_use_case_setup_flow"></a>
Workflow</h2>
<ol type="1">
<li>Ensure that <a class="el" href="group__group__common__boards.html#ga916f2adc2080b4fe88034086d107a8dc" title="This function initializes the board target resources.">board_init()</a> has configured selected I/Os for TWI function when using external AT45DBX dataflash</li>
<li>Ensure that <a class="el" href="conf__nvm_8h.html">conf_nvm.h</a> is present for the driver.<ul>
<li><dl class="section note"><dt>Note:</dt><dd>This file is only for the driver and should not be included by the user.</dd></dl>
</li>
</ul>
</li>
<li>Call nvm_init <div class="fragment"><div class="line"> <a class="code" href="xmega__nvm_8c.html#a0ac16f4de49f2f0df16e3cf56be5f578" title="Initialize the non volatile memory specified.">nvm_init</a>(INT_FLASH); </div>
</div><!-- fragment --> and optionally check its return code</li>
</ol>
<h1><a class="anchor" id="nvm_basic_use_case_usage"></a>
Usage steps</h1>
<h2><a class="anchor" id="nvm_basic_use_case_usage_code_writing"></a>
Example code: Writing to</h2>
<p>non volatile memory Use in the application C-file: </p>
<div class="fragment"><div class="line">           uint8_t buffer[] = {0xAA, 0xBB, 0xCC, 0xDD, 0xEE};</div>
<div class="line"></div>
<div class="line">           <span class="keywordflow">if</span>(<a class="code" href="xmega__nvm_8c.html#ae2475c24bb003e7e1368d2c488d22db3" title="Write len number of bytes at address address in non volatile memory mem from the buffer buffer...">nvm_write</a>(INT_FLASH, test_address, (<span class="keywordtype">void</span> *)buffer, <span class="keyword">sizeof</span>(buffer)) ==</div>
<div class="line">         <a class="code" href="group__group__xmega__utils__status__codes.html#gga751c892e5a46b8e7d282085a5a5bf151a7e4a42e3b6dd63708c64cf3db6f69566" title="Success.">STATUS_OK</a>)</div>
<div class="line">             do_something();</div>
</div><!-- fragment --><h2><a class="anchor" id="nvm_basic_use_case_usage_flow"></a>
Workflow</h2>
<ol type="1">
<li>Prepare the data you want to send to the non volatile memory <div class="fragment"><div class="line"> uint8_t buffer[] = {0xAA, 0xBB, 0xCC, 0xDD, 0xEE}; </div>
</div><!-- fragment --></li>
<li>Call nvm_write <div class="fragment"><div class="line"> <a class="code" href="xmega__nvm_8c.html#ae2475c24bb003e7e1368d2c488d22db3" title="Write len number of bytes at address address in non volatile memory mem from the buffer buffer...">nvm_write</a>(INT_FLASH, test_address, (<span class="keywordtype">void</span> *)buffer,</div>
<div class="line">         <span class="keyword">sizeof</span>(buffer)) </div>
</div><!-- fragment --> and optionally check its return value for STATUS_OK.</li>
</ol>
<h2><a class="anchor" id="nvm_basic_use_case_usage_code_reading"></a>
Example code: Reading from</h2>
<p>non volatile memory Use in application C-file: </p>
<div class="fragment"><div class="line">           uint8_t data_read[8];</div>
<div class="line"></div>
<div class="line">           <span class="keywordflow">if</span>(<a class="code" href="xmega__nvm_8c.html#a38c20e73ee79e686204f85e88854e5d1" title="Read len number of bytes from address address in non volatile memory mem and store it in the buffer b...">nvm_read</a>(INT_FLASH, test_address, (<span class="keywordtype">void</span> *)data_read, <span class="keyword">sizeof</span>(data_read))</div>
<div class="line">         == <a class="code" href="group__group__xmega__utils__status__codes.html#gga751c892e5a46b8e7d282085a5a5bf151a7e4a42e3b6dd63708c64cf3db6f69566" title="Success.">STATUS_OK</a>) {</div>
<div class="line">             <span class="comment">//Check read content</span></div>
<div class="line">             <span class="keywordflow">if</span>(data_read[0] == 0xAA)</div>
<div class="line">               do_something();</div>
<div class="line">           }</div>
</div><!-- fragment --><h2><a class="anchor" id="nvm_basic_use_case_usage_flow"></a>
Workflow</h2>
<ol type="1">
<li>Prepare a data buffer that will read data from non volatile memory <div class="fragment"><div class="line"> uint8_t data_read[8]; </div>
</div><!-- fragment --></li>
<li>Call nvm_read <div class="fragment"><div class="line"> <a class="code" href="xmega__nvm_8c.html#a38c20e73ee79e686204f85e88854e5d1" title="Read len number of bytes from address address in non volatile memory mem and store it in the buffer b...">nvm_read</a>(INT_FLASH, test_address, (<span class="keywordtype">void</span> *)data_read,</div>
<div class="line">         <span class="keyword">sizeof</span>(data_read)); </div>
</div><!-- fragment --> and optionally check its return value for STATUS_OK. The data read from the non volatile memory are in data_read.</li>
</ol>
<h2><a class="anchor" id="nvm_basic_use_case_usage_code_erasing"></a>
Example code: Erasing a</h2>
<p>page of non volatile memory Use in the application C-file: </p>
<div class="fragment"><div class="line">        <span class="keywordflow">if</span>(<a class="code" href="xmega__nvm_8c.html#a647ad906f2c90020d68084b0d3c7c206" title="Erase a page in the non volatile memory.">nvm_page_erase</a>(INT_FLASH, test_page) == <a class="code" href="group__group__xmega__utils__status__codes.html#gga751c892e5a46b8e7d282085a5a5bf151a7e4a42e3b6dd63708c64cf3db6f69566" title="Success.">STATUS_OK</a>)</div>
<div class="line">          do_something();</div>
</div><!-- fragment --><h2><a class="anchor" id="nvm_basic_use_case_usage_flow"></a>
Workflow</h2>
<ol type="1">
<li>Call nvm_page_erase <div class="fragment"><div class="line"> <a class="code" href="xmega__nvm_8c.html#a647ad906f2c90020d68084b0d3c7c206" title="Erase a page in the non volatile memory.">nvm_page_erase</a>(INT_FLASH, test_page) </div>
</div><!-- fragment --> and optionally check its return value for STATUS_OK.</li>
</ol>
<h2><a class="anchor" id="nvm_basic_use_case_usage_code_config"></a>
Example code: Reading</h2>
<p>*configuration of non volatile memory Use in application C-file: </p>
<div class="fragment"><div class="line">           uint8_t mem_size, page_size, page_num;</div>
<div class="line"></div>
<div class="line">           <a class="code" href="xmega__nvm_8c.html#ad90ba5cf40374577ef525365bbc86641" title="Get the size of whole non volatile memory specified.">nvm_get_size</a>(INT_FLASH, &amp;mem_size);</div>
<div class="line">           <a class="code" href="xmega__nvm_8c.html#a784427385b7243e8d69dcb52933116d8" title="Get the size of a page in the non volatile memory specified.">nvm_get_page_size</a>(INT_FLASH, &amp;page_size);</div>
<div class="line">           <a class="code" href="xmega__nvm_8c.html#ae88b4f69e71b6c7991d2e222ec7f4bc6" title="Get the page number from the byte address address.">nvm_get_pagenumber</a>(INT_FLASH, test_address, &amp;page_num);</div>
</div><!-- fragment --><h2><a class="anchor" id="nvm_basic_use_case_usage_flow"></a>
Workflow</h2>
<ol type="1">
<li>Prepare a buffer to store configuration of non volatile memory <div class="fragment"><div class="line"> uint8_t mem_size, page_size, page_num; </div>
</div><!-- fragment --></li>
<li>Call nvm_get_size <div class="fragment"><div class="line"> <a class="code" href="xmega__nvm_8c.html#ad90ba5cf40374577ef525365bbc86641" title="Get the size of whole non volatile memory specified.">nvm_get_size</a>(INT_FLASH, &amp;mem_size); </div>
</div><!-- fragment --> and optionally check its return value for STATUS_OK. The memory size of the non volatile memory is in mem_size.</li>
<li>Call nvm_get_page_size <div class="fragment"><div class="line"> <a class="code" href="xmega__nvm_8c.html#a784427385b7243e8d69dcb52933116d8" title="Get the size of a page in the non volatile memory specified.">nvm_get_page_size</a>(INT_FLASH, &amp;page_size);</div>
</div><!-- fragment --> and optionally check its return value for STATUS_OK. The page size of the non volatile memory is in page_size.</li>
<li>Call nvm_get_pagenumber <div class="fragment"><div class="line"> nvm_get_page_number(INT_FLASH, test_address,</div>
<div class="line">         &amp;page_num); </div>
</div><!-- fragment --> and optionally check its return value for STATUS_OK. The page number of given address in the non volatile memory is in page_num.</li>
</ol>
<h2><a class="anchor" id="nvm_basic_use_case_usage_code_locking"></a>
Example code: Enabling</h2>
<p>security bit Use in the application C-file: </p>
<div class="fragment"><div class="line">        <span class="keywordflow">if</span>(<a class="code" href="xmega__nvm_8c.html#af15d68188f29bee24b7cdc19e835e293" title="Enable security bit which blocks external read and write access to the device.">nvm_set_security_bit</a>() == <a class="code" href="group__group__xmega__utils__status__codes.html#gga751c892e5a46b8e7d282085a5a5bf151a7e4a42e3b6dd63708c64cf3db6f69566" title="Success.">STATUS_OK</a>)</div>
<div class="line">          do_something();</div>
</div><!-- fragment --><h2><a class="anchor" id="nvm_basic_use_case_usage_flow"></a>
Workflow</h2>
<ol type="1">
<li>Call nvm_set_security_bit <div class="fragment"><div class="line"> <a class="code" href="xmega__nvm_8c.html#af15d68188f29bee24b7cdc19e835e293" title="Enable security bit which blocks external read and write access to the device.">nvm_set_security_bit</a>() </div>
</div><!-- fragment --> and optionally check its return value for STATUS_OK. </li>
</ol>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue Oct 10 2017 23:17:48 for OnePos by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.1.1
</small></address>
</body>
</html>

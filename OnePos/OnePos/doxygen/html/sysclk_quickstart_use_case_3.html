<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>OnePos: Advanced use case - DFLL auto-calibration (XMEGA)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">OnePos
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.1.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Advanced use case - DFLL auto-calibration (XMEGA) </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="sysclk_quickstart_use_case_3"></a>
Advanced use case - DFLL auto-calibration (XMEGA)</h1>
<p>This section will present a more advanced use case for the System Clock Management service. This use case will configure the main system clock to 2MHz, using the internal 2MHz RC oscillator calibrated against the internal 32KHz oscillator. The peripheral bus clocks will run at the same speed as the CPU clock, and the USB clock will be configured to use the internal 32MHz (nominal) RC oscillator calibrated to 48MHz with the USB Start-of-Frame as the calibration reference.</p>
<h2><a class="anchor" id="sysclk_quickstart_use_case_3_prereq"></a>
Prerequisites</h2>
<ul>
<li>None</li>
</ul>
<h2><a class="anchor" id="sysclk_quickstart_use_case_3_setup_steps"></a>
Initialization code</h2>
<p>Add to the application initialization code: </p>
<div class="fragment"><div class="line">        <a class="code" href="group__sysclk__group.html#ga242399e48a97739c88b4d0c00f6101de" title="Initialize the synchronous clock system.">sysclk_init</a>();</div>
</div><!-- fragment --><h2><a class="anchor" id="sysclk_quickstart_use_case_3_setup_steps_workflow"></a>
Workflow</h2>
<ol type="1">
<li>Configure the system clocks according to the settings in <a class="el" href="conf__clock_8h.html" title="Chip-specific system clock manager configuration.">conf_clock.h</a>: <div class="fragment"><div class="line"> <a class="code" href="group__sysclk__group.html#ga242399e48a97739c88b4d0c00f6101de" title="Initialize the synchronous clock system.">sysclk_init</a>(); </div>
</div><!-- fragment --></li>
</ol>
<h2><a class="anchor" id="sysclk_quickstart_use_case_3_example_code"></a>
Example code</h2>
<p>Add or uncomment the following in your <a class="el" href="conf__clock_8h.html" title="Chip-specific system clock manager configuration.">conf_clock.h</a> header file, commenting out all other definitions of the same symbol(s): </p>
<div class="fragment"><div class="line"><span class="preprocessor">           #define CONFIG_SYSCLK_SOURCE                SYSCLK_SRC_RC2MHZ</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">           #define CONFIG_OSC_AUTOCAL_RC2MHZ_REF_OSC   OSC_ID_RC32KHZ</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">           #define CONFIG_USBCLK_SOURCE                USBCLK_SRC_RCOSC</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">           #define CONFIG_OSC_RC32_CAL                 48000000UL</span></div>
<div class="line"><span class="preprocessor">           #define CONFIG_OSC_AUTOCAL_RC32MHZ_REF_OSC  OSC_ID_USBSOF</span></div>
</div><!-- fragment --><h2><a class="anchor" id="sysclk_quickstart_use_case_3_example_workflow"></a>
Workflow</h2>
<ol type="1">
<li>Configure the main system clock to use the internal 2MHz RC oscillator as its source: <div class="fragment"><div class="line"><span class="preprocessor">        #define CONFIG_SYSCLK_SOURCE                SYSCLK_SRC_RC2MHZ</span></div>
</div><!-- fragment --></li>
<li>Configure the 2MHz DFLL auto-calibration to use the internal 32KHz RC oscillator: <div class="fragment"><div class="line"><span class="preprocessor">        #define CONFIG_OSC_AUTOCAL_RC2MHZ_REF_OSC   OSC_ID_RC32KHZ</span></div>
</div><!-- fragment --> <dl class="section note"><dt>Note:</dt><dd>For auto-calibration it's typically more relevant to use an external 32KHz crystal. So if that's the case use OSC_ID_XOSC instead.</dd></dl>
</li>
<li>Configure the USB module clock to use the internal fast (32MHz) RC oscillator: <div class="fragment"><div class="line"><span class="preprocessor">        #define CONFIG_USBCLK_SOURCE                USBCLK_SRC_RCOSC</span></div>
</div><!-- fragment --></li>
<li>Configure the internal fast (32MHz) RC oscillator to calibrate to 48MHz using the USB Start of Frame (SOF) as the calibration reference: <div class="fragment"><div class="line"><span class="preprocessor">        #define CONFIG_USBCLK_SOURCE                USBCLK_SRC_RCOSC</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">        #define CONFIG_OSC_RC32_CAL                 48000000UL</span></div>
<div class="line"><span class="preprocessor">        #define CONFIG_OSC_AUTOCAL_RC32MHZ_REF_OSC  OSC_ID_USBSOF</span></div>
</div><!-- fragment --> </li>
</ol>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue Oct 10 2017 23:17:48 for OnePos by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.1.1
</small></address>
</body>
</html>
